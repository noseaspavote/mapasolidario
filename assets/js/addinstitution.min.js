function getAjaxPromise(o){return $.ajax({url:$("body").data("site-url")+o,dataType:"json",method:"get"}).fail(function(){})}function initMap(){mapCanvas=L.map("map-institution").setView([-34.766667,-58.4],16),_geocoder=L.Control.Geocoder.nominatim(),control=L.Control.geocoder({geocoder:_geocoder}).addTo(mapCanvas)}function searchGeocode(o){_geocoder.geocode(o,function(o){var e=o[0];e&&($("#latitude").val(e.center.lat),$("#longitude").val(e.center.lng))})}function loadDistricts(o){var e=getAjaxPromise("api/districts/id_province/"+o,"get","json");_districtCombo.attr("disabled","disabled"),e.done(function(o){$.each(o,function(o,e){_districtCombo.append("<option value="+e.id+">"+e.name+"</option>")}),_districtCombo.removeAttr("disabled")})}function loadCities(o){var e=getAjaxPromise("api/cities/district_id/"+o,"get","json");_cityCombo.attr("disabled","disabled"),e.done(function(o){$.each(o,function(o,e){_cityCombo.append("<option value="+e.id+">"+e.name+"</option>")}),_cityCombo.removeAttr("disabled")})}var mapCanvas,marker,_geocoder,_provinceCombo=$("#province_id"),_districtCombo=$("#district_id"),_cityCombo=$("#city_id"),_institutionTypeCombo=$("#institution_type_id");$(document).ready(function(){initMap(),_provinceCombo.change(function(){""==_provinceCombo.val()?(_districtCombo.empty(),_districtCombo.append('<option value="">---- Seleccione un partido ----</option>'),_districtCombo.attr("disabled","disabled"),_cityCombo.empty(),_cityCombo.append('<option value="">---- Seleccione una ciudad ----</option>'),_cityCombo.attr("disabled","disabled")):(_districtCombo.empty(),_districtCombo.append('<option value="">---- Seleccione un partido ----</option>'),loadDistricts(_provinceCombo.val()),_cityCombo.empty(),_cityCombo.append('<option value="">---- Seleccione una ciudad ----</option>'),_cityCombo.attr("disabled","disabled"))}),$(".geocode-params").on("change",function(){searchGeocode($("#street_name").val()+" "+$("#street_number").val()+", "+$("#city_id option:selected").text()+", "+$("#district_id option:selected").text()+", "+$("#province_id option:selected").text())}),_districtCombo.change(function(){""==_districtCombo.val()?(_cityCombo.empty(),_cityCombo.append('<option value="">---- Seleccione una ciudad ----</option>'),_cityCombo.attr("disabled","disabled")):(_cityCombo.empty(),_cityCombo.append('<option value="">---- Seleccione un ciudad ----</option>'),loadCities(_districtCombo.val()))}),$("#alias").keyup(function(){if($("#alias").val().length>=4){var o=getAjaxPromise("api/markers.geojson/alias/"+$("#alias").val());o.done(function(o){$("#alias_check").val(0===o.features.length)})}}),$(".uppercase").change(function(){$(this).val($(this).val().toUpperCase())}),$.formUtils.addValidator({name:"check_email",validatorFunction:function(o,e,i,t,a){return $("#email").val()===o},errorMessage:"El mail no coincide con el ingresado. Por favor, vuelva a ingresarlo.",errorMessageKey:"badMailCheck"}),$.formUtils.addValidator({name:"unique_alias",validatorFunction:function(o,e,i,t,a){return $("#alias").val().length<4?!1:"false"==$("#alias_check").val()?!1:!0},errorMessage:"El alias debe tener más de 3 caracteres y ser único. Intenta nuevamente."}),$.formUtils.addValidator({name:"check_suscriptor_email",validatorFunction:function(o,e,i,t,a){return $("#suscriptor_email").val()===o},errorMessage:"El mail no coincide con el ingresado. Por favor, vuelva a ingresarlo.",errorMessageKey:"badMailCheck"}),$.validate({modules:"html5",onSuccess:function(){return $("#btnSubmit").attr("disabled","disabled"),!0}})});